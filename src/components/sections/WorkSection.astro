---
import { projectsData } from '@/data/projects';
import ProjectFilter from '@/components/ui/ProjectFilter';

const featured = projectsData.filter((p) => p.featured);
const others = projectsData.filter((p) => !p.featured);
const allTech = [...new Set(projectsData.flatMap((p) => p.tags))].slice(0, 10);
---

<section id="work" class="section-padding">
  <div class="container-custom">
    <!-- Section Header -->
    <div class="text-center mb-16">
      <h2 class="text-4xl md:text-5xl font-bold mb-4">
        <span class="gradient-text">My Work</span>
      </h2>
      <p class="text-xl text-white/70 max-w-2xl mx-auto">
        A collection of projects I've built, ranging from web applications to AI-powered solutions.
      </p>
    </div>

    <!-- Featured Projects -->
    <div class="mb-20">
      <h3 class="text-2xl md:text-3xl font-bold mb-8 flex items-center gap-3">
        <span class="text-3xl">‚≠ê</span>
        Featured Projects
      </h3>
      <div class="grid md:grid-cols-2 gap-8">
        {featured.map((project, index) => (
          <div
            class="featured-project glass-card rounded-2xl overflow-hidden card-hover group"
            data-index={index}
          >
            {/* Project Image */}
            <div class="aspect-video bg-gradient-to-br from-primary-900/50 to-accent-900/50 relative overflow-hidden">
              <img
                src={project.image}
                alt={project.title}
                class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-all duration-500"
              />
            </div>

            {/* Project Content */}
            <div class="p-8">
              <h4 class="text-2xl font-bold mb-3 group-hover:text-primary-400 transition-colors">
                {project.title}
              </h4>
              <p class="text-white/70 mb-4">
                {project.description}
              </p>

              {/* Responsibilities */}
              {project.responsibilities.length > 0 && (
                <div class="mb-6">
                  <h5 class="text-sm font-semibold text-white/80 mb-2">Key Highlights:</h5>
                  <ul class="space-y-2">
                    {project.responsibilities.slice(0, 3).map((resp) => (
                      <li class="text-sm text-white/70 flex gap-2">
                        <span class="text-primary-400 mt-1">‚Ä¢</span>
                        <span>{resp}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              {/* Tags */}
              <div class="flex flex-wrap gap-2 mb-6">
                {project.tags.map((tag) => (
                  <span class="px-3 py-1 rounded-full text-xs glass text-white/80">
                    {tag}
                  </span>
                ))}
              </div>

              {/* Links */}
              <div class="flex gap-3">
                {project.link && (
                  <a
                    href={project.link}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex-1 btn-primary text-center"
                  >
                    Live Demo
                  </a>
                )}
                <a
                  href={project.repositoryLink}
                  target="_blank"
                  rel="noopener noreferrer"
                  class={`${
                    project.link ? 'flex-1' : 'w-full'
                  } btn-secondary text-center`}
                >
                  View on GitHub
                </a>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Other Projects -->
    {others.length > 0 && (
      <div>
        <h3 class="text-2xl md:text-3xl font-bold mb-8 flex items-center gap-3">
          <span class="text-3xl">üíº</span>
          Other Projects
        </h3>
        <ProjectFilter
          client:visible
          projects={others}
          technologies={allTech}
        />
      </div>
    )}
  </div>
</section>

<script>
  // Intersection Observer for featured projects
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.2 }
  );

  document.querySelectorAll('.featured-project').forEach((el) => {
    observer.observe(el);
  });
</script>

<style>
  .featured-project {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .featured-project.in-view {
    opacity: 1;
    transform: translateY(0);
  }

  /* Stagger featured projects */
  .featured-project[data-index="0"].in-view { transition-delay: 0s; }
  .featured-project[data-index="1"].in-view { transition-delay: 0.15s; }
  .featured-project[data-index="2"].in-view { transition-delay: 0.3s; }
  .featured-project[data-index="3"].in-view { transition-delay: 0.45s; }
</style>
